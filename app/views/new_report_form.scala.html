@(labTests: List[LabTest])

<link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/main.css")">
<link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/new-report.css")">
<link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/bootstrap-select.min.css")">
<link rel="stylesheet" media="screen" href="@routes.Assets.versioned("stylesheets/animate.css")">
<script src="@routes.Assets.versioned("javascripts/bootstrap.min.js")"></script>
<script src="@routes.Assets.versioned("javascripts/bootstrap-select.min.js")"></script>
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<div id="navbar-container">
	<nav class="navbar navbar-default">
		<div class="container-fluid">
   			<div class="navbar-header">
     				<a id="logo-container" class="navbar-brand" href="#">
       			<img alt="LabCo" src="@routes.Assets.versioned("images/favicon.png")">
     			</a>
   		</div>
	</nav>
</div>

<!-- progressbar -->
<ul id="progressbar">
	<li class="active">Report type</li>
	<li>Report parameters</li>
</ul>
	
<br>
	
<div id="form-container-1" class="form-container">
	<form class="form-horizontal form-wrapper">
		<div class="np-form form-group">
			<label for="report-type">Choose report type</label><br>
			<select id="report-type" class="selectpicker form-control">
		  		@labTests.map { labTest => 
		  			<option value="@labTest.getId().toString()">@labTest.getName()</option>
		  		}
			</select>
		</div>
		<div class="form-group">
			<div class="np-form col-sm-10">
				<label for="patient-name">Patient Name</label>
		      	<input type="text" class="form-control" id="patient-name" >
		    </div>
		</div>
		<div class="form-group">
			<div class="np-form col-sm-10">
		      	<label for="patient-id">Patient ID</label>
		      	<input type="text" class="form-control">
		    </div>
		</div>
		<div class="form-group">
			<div class="np-form col-sm-10">
		      <button id="submit-form-1" type="button" class="btn btn-success">
		      	Next
		      	<span class="glyphicon glyphicon-menu-right"></span>
		      </button>
		    </div>
		</div>
	</form>
</div>
<div id="form-container-2" class="form-container animated bounceInRight" style="display:none;">
</div>
<script>
function onBounceOutLeftEnd() {
	$('#form-container-1').hide();
	$('#form-container-2').show();
}

function create_col(val) {
	var col = document.createElement("div");
	col.setAttribute('class', "col-lg-6");
	
	var item = document.createElement("div");
	item.setAttribute('class', "np-form form-group");
	
	var newlabel = document.createElement("Label");
	newlabel.setAttribute("for",val.param_name);
	newlabel.innerHTML = val.param_name;
	item.appendChild(newlabel);
	
	var inputgroup = document.createElement("div");
	inputgroup.setAttribute('class', "input-group");
	inputgroup.setAttribute('id', "param-input-group");
	
	var element = document.createElement("input"); //input element, text
	element.setAttribute('type',"text");
	element.setAttribute('name',val.param_name); 
	element.setAttribute('class', "form-control");
	inputgroup.appendChild(element);
	
	if(val.param_unit != "") {
		var span = document.createElement("span");
		span.setAttribute('class', "input-group-addon");
		span.innerHTML = val.param_unit;
		inputgroup.appendChild(span);	
	}
	
	item.appendChild(inputgroup);
	col.appendChild(item);
	
	return col;
}

function create_form(data) {
	var f = document.createElement("form");
	
	for (i = 0; i < data.length; i+=2) {
		var row = document.createElement("div");
		row.setAttribute('class', "row");
		
		var col1 = create_col(data[i]);
		row.appendChild(col1);
		
		if (i + 1 < data.length) {
			var col2 = create_col(data[i + 1]);
			row.appendChild(col2);
		}
		
		f.appendChild(row);		
	}
	
	var saveButton = document.createElement("button"); //input element, Submit button
	saveButton.setAttribute('type',"button");
	saveButton.setAttribute('class',"btn btn-danger");	
	var span = document.createElement("span");
	span.setAttribute('class', "glyphicon glyphicon-ok");
	span.innerHTML = "Save";
	saveButton.appendChild(span);
	
	f.appendChild(saveButton);
	
	$("#form-container-2").append(f);
}

function fetchParametersForTestId(testId) {
	$.ajax({
	      url: "https://demo3332037.mockable.io/lab-tests/" + testId + "/parameters",
	      dataType: 'json',
	      cache: false,
	      success: function(data) {
	    	  console.log("onSuccess while fetching parameters, data: " + JSON.stringify(data));
	    	  create_form(data);
	      }.bind(this),
	      error: function(xhr, status, err) {
	        console.error("onError while fetching parameters", status, err.toString());
	      }.bind(this)
	    });
}

function getSelectedTestId() {
	return $("#report-type").val();
}

$(document).ready(function() {
	$('#form-container-1').one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', onBounceOutLeftEnd);
	
	$('#submit-form-1').one('click', function() {
		console.log("Next is clicked");
    	
		$('#form-container-1').addClass('animated bounceOutLeft');
    	 
    	 $("#submit-form-1").text(' Saving...'); 
    	 $("#submit-form-1").blur(); 
    	 $("#submit-form-1").removeClass('btn btn-success'); 
    	 $("#submit-form-1").addClass('btn btn-warning'); 
    	 $("#submit-form-1").prepend("<span class=\"glyphicon glyphicon-refresh glyphicon-refresh-animate\"></span>");
    	$("#progressbar li").eq(1).addClass("active");
    	
    	var selectedTestId = getSelectedTestId();
		fetchParametersForTestId(selectedTestId);
    	
 		
    });
	
});
</script>
